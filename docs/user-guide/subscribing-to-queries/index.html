<!DOCTYPE html>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    
		<link href="../../_app/immutable/assets/Highlight.CMYouZ3z.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.CQTVce_U.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B9vQeFqv.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/xPuFI3q7.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DnMb0p-7.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CRebRYD9.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.DMGPz-LM.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CJ7D-XRr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CfC-N_a3.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/qRCaFh0V.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/co5wIi-m.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BmIVwnlB.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Di4Fxgih.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.BAm7ERby.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Dx4IbXf0.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Bvena8yX.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C6-5CMiK.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CgZvsY_p.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/24.BNHiQw9Z.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C0NHSKHS.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Ce9AoNbY.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/9N_cuTOb.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B44ft2AR.js"><!--[--><meta name="description" content="Object relational mapper for Node.js and the browser"> <meta property="og:title" content="Nymph"> <meta property="og:type" content="website"> <meta property="og:url" content="http://nymph.io/"> <meta property="og:image" content="https://raw.githubusercontent.com/sciactive/nymph/master/assets/nymph-logo-500.png"> <meta property="og:site_name" content="Nymph"> <meta property="fb:admins" content="508999194"> <meta property="og:description" content="Object relational mapper for Node.js and the browser"> <link rel="icon" href="../../images/cropped-logo-32x32.png" sizes="32x32"> <link rel="icon" href="../../images/cropped-logo-192x192.png" sizes="192x192"> <link rel="apple-touch-icon" href="../../images/cropped-logo-180x180.png"> <meta name="msapplication-TileImage" content="../../images/cropped-logo-270x270.png"> <link rel="stylesheet" href="../../css/main.css"><!--]--><!--[--><!----><style>pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}
/*!
  Theme: GitHub
  Description: Light theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-light
  Current colors taken from GitHub's CSS
*/.hljs{color:#24292e;background:#ffffff}.hljs-doctag,
.hljs-keyword,
.hljs-meta .hljs-keyword,
.hljs-template-tag,
.hljs-template-variable,
.hljs-type,
.hljs-variable.language_{color:#d73a49}.hljs-title,
.hljs-title.class_,
.hljs-title.class_.inherited__,
.hljs-title.function_{color:#6f42c1}.hljs-attr,
.hljs-attribute,
.hljs-literal,
.hljs-meta,
.hljs-number,
.hljs-operator,
.hljs-variable,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-id{color:#005cc5}.hljs-regexp,
.hljs-string,
.hljs-meta .hljs-string{color:#032f62}.hljs-built_in,
.hljs-symbol{color:#e36209}.hljs-comment,
.hljs-code,
.hljs-formula{color:#6a737d}.hljs-name,
.hljs-quote,
.hljs-selector-tag,
.hljs-selector-pseudo{color:#22863a}.hljs-subst{color:#24292e}.hljs-section{color:#005cc5;font-weight:bold}.hljs-bullet{color:#735c0f}.hljs-emphasis{color:#24292e;font-style:italic}.hljs-strong{color:#24292e;font-weight:bold}.hljs-addition{color:#22863a;background-color:#f0fff4}.hljs-deletion{color:#b31d28;background-color:#ffeef0}</style><!----><!--]--><title>Subscribing to Queries - User Guide - Nymph.js</title>
  </head>
  <body class="is-preload">
    <!--[--><!--[--><!----><div id="main" tabindex="0" role="button"><div class="inner"><header id="header"><div class="logo"><a href="../../" class="logo"><strong>Nymph.js</strong></a></div> <ul class="icons"><li><a href="https://port87.social/@hperrin" target="_blank" rel="noreferrer" class="icon brands" title="Mastodon"><svg style="width: 24px; height: 24px; vertical-align: middle;" viewBox="0 0 24 24"><path fill="currentColor" d="M20.94,14C20.66,15.41 18.5,16.96 15.97,17.26C14.66,17.41 13.37,17.56 12,17.5C9.75,17.39 8,16.96 8,16.96V17.58C8.32,19.8 10.22,19.93 12.03,20C13.85,20.05 15.47,19.54 15.47,19.54L15.55,21.19C15.55,21.19 14.27,21.87 12,22C10.75,22.07 9.19,21.97 7.38,21.5C3.46,20.45 2.78,16.26 2.68,12L2.67,8.57C2.67,4.23 5.5,2.96 5.5,2.96C6.95,2.3 9.41,2 11.97,2H12.03C14.59,2 17.05,2.3 18.5,2.96C18.5,2.96 21.33,4.23 21.33,8.57C21.33,8.57 21.37,11.78 20.94,14M18,8.91C18,7.83 17.7,7 17.15,6.35C16.59,5.72 15.85,5.39 14.92,5.39C13.86,5.39 13.05,5.8 12.5,6.62L12,7.5L11.5,6.62C10.94,5.8 10.14,5.39 9.07,5.39C8.15,5.39 7.41,5.72 6.84,6.35C6.29,7 6,7.83 6,8.91V14.17H8.1V9.06C8.1,8 8.55,7.44 9.46,7.44C10.46,7.44 10.96,8.09 10.96,9.37V12.16H13.03V9.37C13.03,8.09 13.53,7.44 14.54,7.44C15.44,7.44 15.89,8 15.89,9.06V14.17H18V8.91Z"></path></svg><!----></a></li> <li><a href="https://github.com/sciactive/nymphjs" target="_blank" rel="noreferrer" class="icon brands" title="GitHub"><svg style="width: 24px; height: 24px; vertical-align: middle;" viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg><!----></a></li></ul></header><!----> <!----><section><header class="major"><h1 style="font-size: 3em;">Subscribing to Queries</h1></header> <p>Subscribing to a query lets you receive updates to that query. This is a
    powerful tool for collaborative apps. It's also just as easy as making a
    regular entity query.</p> <p>Before we get started, you can follow the <a href="../../packages/pubsub/">PubSub Server Package</a> page to set up a Nymph PubSub server.</p> <p>You can use the <code>subscribeEntities</code> method on PubSub to subscribe
    to a query. It will return a function you can call to subscribe to the
    query. That function accepts a resolve and reject callback, similar to a
    promise. The resolve function will receive an update, which will at first be
    an array of entities, then will be an update object with instructions that <code>updateArray</code> uses to update the original array.</p> <!----><pre data-language="typescript" class="svelte-1w9vok"><code class="hljs"><!--[--><!----><span class="hljs-keyword">let</span> <span class="hljs-attr">smiths</span>: (<span class="hljs-title class_">User</span> &amp; <span class="hljs-title class_">UserData</span>)[] = [];
pubsub.<span class="hljs-title function_">subscribeEntities</span>(
  {
    <span class="hljs-attr">class</span>: <span class="hljs-title class_">User</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>,
    <span class="hljs-attr">like</span>: [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;% Smith&#x27;</span>]
  }
)(
  <span class="hljs-function">(<span class="hljs-params">update</span>) =&gt;</span> {
    <span class="hljs-comment">// This function will be called once initially with an array of</span>
    <span class="hljs-comment">// entities, then again every time there&#x27;s a change with an</span>
    <span class="hljs-comment">// update object.</span>
    <span class="hljs-comment">// The updateArray function will add any newly matching entities,</span>
    <span class="hljs-comment">// update any existing entities that have changed, and remove any</span>
    <span class="hljs-comment">// entities that no longer match (including deleted entities).</span>
    pubsub.<span class="hljs-title function_">updateArray</span>(smiths, update);
  },
  <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Error: &#x27;</span> + e.<span class="hljs-property">textStatus</span>);
  }
);<!----><!--]--></code></pre><!----><!----> <p>You can also receive a count of how many subscribers there are to that
    query. The count is given to a third callback.</p> <!----><pre data-language="typescript" class="svelte-1w9vok"><code class="hljs"><!--[--><!----><span class="hljs-keyword">let</span> <span class="hljs-attr">smiths</span>: (<span class="hljs-title class_">User</span> &amp; <span class="hljs-title class_">UserData</span>)[] = [];
pubsub.<span class="hljs-title function_">subscribeEntities</span>(
  {
    <span class="hljs-attr">class</span>: <span class="hljs-title class_">User</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>,
    <span class="hljs-attr">like</span>: [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;% Smith&#x27;</span>]
  }
)(
  <span class="hljs-function">(<span class="hljs-params">update</span>) =&gt;</span> {
    pubsub.<span class="hljs-title function_">updateArray</span>(smiths, update);
  },
  <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Error: &#x27;</span> + e.<span class="hljs-property">textStatus</span>);
  },
  <span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> {
    <span class="hljs-comment">// This function will be called each time the count of</span>
    <span class="hljs-comment">// subscribers to this query changes.</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`There are now <span class="hljs-subst">${count}</span> users watching the Smiths.`</span>);
  }
);<!----><!--]--></code></pre><!----><!----> <p>To unsubscribe from the query, use the <code>unsubscribe</code> method on
    the <code>PubSubSubscription</code> object returned by the function.</p> <!----><pre data-language="typescript" class="svelte-1w9vok"><code class="hljs"><!--[--><!----><span class="hljs-keyword">let</span> <span class="hljs-attr">smiths</span>: (<span class="hljs-title class_">User</span> &amp; <span class="hljs-title class_">UserData</span>)[] = [];
<span class="hljs-keyword">let</span> subscription = pubsub.<span class="hljs-title function_">subscribeEntities</span>(
  {
    <span class="hljs-attr">class</span>: <span class="hljs-title class_">User</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>,
    <span class="hljs-attr">like</span>: [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;% Smith&#x27;</span>]
  }
)(<span class="hljs-function">(<span class="hljs-params">update</span>) =&gt;</span> {
  pubsub.<span class="hljs-title function_">updateArray</span>(smiths, update);
});

<span class="hljs-title function_">onDestroy</span>(<span class="hljs-function">() =&gt;</span> {
  subscription.<span class="hljs-title function_">unsubscribe</span>();
});<!----><!--]--></code></pre><!----><!----> <p>You can subscribe to changes to an entity with the <code>subscribeWith</code> method. This method accepts the callbacks directly and returns a <code>PubSubSubscription</code> object.</p> <!----><pre data-language="typescript" class="svelte-1w9vok"><code class="hljs"><!--[--><!----><span class="hljs-keyword">let</span> subscription = pubsub.<span class="hljs-title function_">subscribeWith</span>(
  smithEntity,
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (smithEntity.<span class="hljs-property">guid</span> == <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">confirm</span>(<span class="hljs-string">&#x27;Someone deleted Mr. Smith! Do you want to restore him?&#x27;</span>)) {
        smithEntity.$save();
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Mr. Smith&#x27;s entity has changed!&quot;</span>);
    }
  },
  <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;Error: &#x27;</span> + e.<span class="hljs-property">textStatus</span>);
  },
  <span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`There are now <span class="hljs-subst">${count}</span> users watching Mr. Smith.`</span>);
  }
);

<span class="hljs-title function_">onDestroy</span>(<span class="hljs-function">() =&gt;</span> {
  subscription.<span class="hljs-title function_">unsubscribe</span>();
});<!----><!--]--></code></pre><!----><!----> <p>Warning: Subscriptions can lead to resource leaks if left open. Take care to
    unsubscribe to every query you are no longer watching.</p> <p>Warning: The PubSub server is smart about removing entities that no longer
    match when a new entity matches, but there are some queries that can have
    changes in their matching entities without any change to the server (like
    relative time queries). These queries won't necessarily be updated correctly
    in due time by the PubSub server.</p></section> <section class="page-steps"><a href="../../user-guide/entity-querying" class="button" style="margin: .5em;">Previous: Entity Querying</a> <a href="../../user-guide/entity-class" class="button" style="margin: .5em;">Next: Entity Class</a></section><!----><!----> <footer id="footer"><p class="copyright">© SciActive Inc. All rights reserved. Design by: <a href="https://html5up.net">HTML5 UP</a>.</p></footer></div></div> <div id="sidebar" role="navigation"><div class="inner"><section id="top-panel" class="alt"><div class="title"><img class="logo" src="../../images/web-logo.png" alt="SciActive"> <span class="name">SciActive</span></div></section> <nav id="menu"><ul><li><a href="../../">Homepage</a></li> <li><span class="opener static">User Guide</span> <ul><li><a href="../../user-guide/introduction">Introduction</a></li> <li><a href="../../user-guide/creating-entities">Creating Entities</a></li> <li><a href="../../user-guide/entity-querying">Entity Querying</a></li> <li><a href="../../user-guide/subscribing-to-queries">Subscribing to Queries</a></li> <li><a href="../../user-guide/entity-class">Entity Class</a></li> <li><a href="../../user-guide/defining-entities">Defining Entities</a></li> <li><a href="../../user-guide/uids">UIDs</a></li> <li><a href="../../user-guide/transactions">Transactions</a></li> <li><a href="../../user-guide/export-and-import">Export and Import</a></li></ul></li> <li><span class="opener static">Packages</span> <ul><li><a href="../../packages/nymph">Nymph Core</a></li> <li><a href="../../packages/driver-mysql">MySQL Driver</a></li> <li><a href="../../packages/driver-postgresql">PostgreSQL Driver</a></li> <li><a href="../../packages/driver-sqlite3">SQLite3 Driver</a></li> <li><a href="../../packages/server">REST Server</a></li> <li><a href="../../packages/pubsub">PubSub Server</a></li> <li><a href="../../packages/client">Client</a></li> <li><a href="../../packages/client-node">Node Client</a></li> <li><a href="../../packages/tilmeld">Tilmeld</a></li> <li><a href="../../packages/tilmeld-client">Tilmeld Client</a></li> <li><a href="../../packages/tilmeld-components">Tilmeld Components</a></li> <li><a href="../../packages/tilmeld-setup">Tilmeld Setup</a></li> <li><a href="../../packages/sorter">Entity Sorter</a></li> <li><a href="../../packages/query-parser">Query Parser</a></li> <li><a href="../../packages/guid">GUID / Unique Code Generator</a></li></ul></li></ul></nav> <section><header class="major"><h2>Get in touch</h2></header> <p>Nymph is a product of SciActive Inc. You can contact SciActive by email
        or post, or follow on Mastodon.</p> <ul class="contact"><li class="icon"><svg style="width: 24px; height: 24px; vertical-align: middle;" viewBox="0 0 24 24"><path fill="currentColor" d="M20.94,14C20.66,15.41 18.5,16.96 15.97,17.26C14.66,17.41 13.37,17.56 12,17.5C9.75,17.39 8,16.96 8,16.96V17.58C8.32,19.8 10.22,19.93 12.03,20C13.85,20.05 15.47,19.54 15.47,19.54L15.55,21.19C15.55,21.19 14.27,21.87 12,22C10.75,22.07 9.19,21.97 7.38,21.5C3.46,20.45 2.78,16.26 2.68,12L2.67,8.57C2.67,4.23 5.5,2.96 5.5,2.96C6.95,2.3 9.41,2 11.97,2H12.03C14.59,2 17.05,2.3 18.5,2.96C18.5,2.96 21.33,4.23 21.33,8.57C21.33,8.57 21.37,11.78 20.94,14M18,8.91C18,7.83 17.7,7 17.15,6.35C16.59,5.72 15.85,5.39 14.92,5.39C13.86,5.39 13.05,5.8 12.5,6.62L12,7.5L11.5,6.62C10.94,5.8 10.14,5.39 9.07,5.39C8.15,5.39 7.41,5.72 6.84,6.35C6.29,7 6,7.83 6,8.91V14.17H8.1V9.06C8.1,8 8.55,7.44 9.46,7.44C10.46,7.44 10.96,8.09 10.96,9.37V12.16H13.03V9.37C13.03,8.09 13.53,7.44 14.54,7.44C15.44,7.44 15.89,8 15.89,9.06V14.17H18V8.91Z"></path></svg><!----> <a href="https://port87.social/@hperrin" target="_blank" rel="noreferrer">@hperrin@port87.social on Mastodon</a></li> <li class="icon"><svg style="width: 24px; height: 24px; vertical-align: middle;" viewBox="0 0 24 24"><path fill="currentColor" d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"></path></svg><!----> <a href="mailto:someone@example.com">(loading...)</a></li> <li class="icon"><svg style="width: 24px; height: 24px; vertical-align: middle;" viewBox="0 0 24 24"><path fill="currentColor" d="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"></path></svg><!----> SciActive Inc<br> 310 S Twin Oaks Valley Rd #107<br> PMB 422<br> San Marcos, CA 92078</li></ul></section></div> <!--[!--><!--]--></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_188095g = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../_app/immutable/entry/start.CQTVce_U.js"),
						import("../../_app/immutable/entry/app.DMGPz-LM.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 24],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		
  </body>
</html>
